import tkinter
from tkinter import *
from tkinter import filedialog as fd
import socket
import ctypes
import os
import sys
import datetime
from datetime import date
import requests
import webbrowser
import psutil

def install():
    if os.path.exists("EasyExploitsDLL.dll"):
                pass
    else:
        ctypes.windll.user32.MessageBoxW(0, "You're Missing EasyExploitsDLL.dll", "Error", 0)
        os.system("pause")
        exit()
    
    if os.path.exists("scripts"):
        pass
    else:
        os.mkdir("scripts")
    
    if os.path.exists("EasyExploits.dll"):
        pass
    else:
        ctypes.windll.user32.MessageBoxW(0, "You're Missing EasyExploits.dll", "Error", 0)
        os.system("pause")
        exit()

import clr
print(os.getcwd())
sys.path.append(os.getcwd())
try:
    clr.AddReference('EasyExploits')
    import EasyExploits as ex
    module = ex.Module()
except:
    ctypes.windll.user32.MessageBoxW(0, "You Don't Have The Necessary Files - Installing Them!", "Error", 0)
    install()

current = os.getcwd()
today = date.today()
ip = requests.get('https://api.ipify.org').text

root = Tk()
root.geometry("800x365")
root.configure(background="black")
root.title(f"Welcome To TOGSPLOIT {socket.gethostname()}! | IP: {ip} | Date: {today}")
#root.iconbitmap('icon.ico')


def open_file():
    file_name = fd.askopenfilename(filetypes=(("TXT files", "*.txt"), ("LUA files", "*.lua")))
    f = open(file_name)
    file_text = f.read()
    txt.delete('1.0', 'end')
    txt.insert(INSERT, file_text)
    f.close()


def open_script():
    r1 = option_R.get()
    file = open('scripts\\' + r1, 'r')
    file_text = file.read()
    txt.delete('1.0', 'end')
    txt.insert(INSERT, file_text)
    file.close()


def save():
    file_name = fd.asksaveasfilename(filetypes=(("TXT files", "*.txt"), ("LUA files", "*.lua")))
    f = open(file_name, 'w')
    text = txt.get('1.0', 'end')
    f.write(text)
    f.close()


def execute():
    script = txt.get('1.0', 'end')
    #module.ExecuteScript(script)


def inject():
    #module.LaunchExploit()
    pass


def clear():
    txt.delete('1.0', 'end')

def opencord():
    webbrowser.open("https://discord.gg/bHt2Skqujk")

def is_connected():
    try:
        socket.create_connection(("1.1.1.1", 53))
        return True
    except OSError:
        return False

files = os.listdir('scripts')
files = filter(lambda x: x.endswith('.txt'), files)
option_R = StringVar()
a = 0
y = 75
s = []
for file in files:
    rdbtn = Radiobutton(root, command=open_script, text=file, variable=option_R, value=file, background="black", foreground="white", font=('Roboto', 10))
    rdbtn.place(x=650, y=y)
    s += [rdbtn]
    y += 20
#backgroundlbl = Label(root, background='red', width=114, height=4)
#backgroundlbl.place(x=0, y=0)
namebutton = Button(root, text='TOGSPLOIT', background='red', foreground='black', font=('Arial Bold', 23), command=opencord)
namebutton.place(x=300, y=0)
txt = Text(root, bd=3, width=80, height=15)
txt.place(x=0, y=65)
clear_btn = Button(root, text='Clear', command=clear, width=17, height=2, bg="purple")
clear_btn.place(x=403, y=320)
exec_btn = Button(root, text='Execute', command=execute, width=17, height=2, bg="purple")
exec_btn.place(x=5, y=320)
inj_btn = Button(root, text='Inject', command=inject, width=20, height=2, bg="red")
inj_btn.place(x=650, y=315)
save_btn = Button(root, text='Save file', command=save, width=17, height=2, bg="purple")
save_btn.place(x=137, y=320)
open_btn = Button(root, text="Open file", command=open_file, width=17, height=2, bg="purple")
open_btn.place(x=270, y=320)

def main():
    if "Windows10Universal.exe" in (i.name() for i in psutil.process_iter()):
        if is_connected():
            root.mainloop()
        else:
            ctypes.windll.user32.MessageBoxW(0, "You are not connected to the internet! Please connect to the internet first!", "Error", 0)
            exit()
    else:
        ctypes.windll.user32.MessageBoxW(0, "Please Open Roblox First, And Then This Application!", "Error", 0)
        exit()

main()
